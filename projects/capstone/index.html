<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <!-- jQuery -->
    <script type="text/javascript" src="../../js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.scrollTo.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src="../../js/bootstrap.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.bundle.min.js"></script>

    <!-- Javascript Libraries -->
    <script type="text/javascript" src="faker.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="//books.google.com/books/previewlib.js"></script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="browsing.css">

    <!-- FontAwesome -->
    <link href="https://use.fontawesome.com/releases/v5.0.2/css/all.css" rel="stylesheet">

</head>

<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="nav-left">
                    <h1 id="">Fiction<span class="fas fa-caret-down"></span></h1>
                    <div class="filter">
                        <span class="filter-title">Age</span>
                        <span class="filter-opt">Young Adult</span>
                        <span class="fas fa-caret-down"></span>
                    </div>
                    <span class="plus">+</span>
                    <div class="filter">
                        <span class="filter-title">Genre</span>
                        <span class="filter-opt">Mystery</span>
                        <span class="fas fa-caret-down"></span>
                    </div>
                    <span class="plus">+</span>

                    <div class="filter">
                        <span class="filter-title">Subject</span>
                        <span class="filter-opt">Family</span>
                        <span class="fas fa-caret-down"></span>
                    </div>
                    <span class="plus">+</span>

                    <div class="filter">
                        <span class="filter-title">Subject</span>
                        <span class="filter-opt">Immigration</span>
                        <span class="fas fa-caret-down"></span>
                    </div>
                    <a class="icon-btn"><span class="fas fa-plus-circle filter-add"></span></a>

                    <!--
                    <select>
                        <option>Young Adult</option>
                        <option>Adult</option>
                        <option>K-12</option>
                    </select>
-->

                    <!--                    <a href="" id="editBtn">edit</a>-->
                </div>
                <div class="nav-right">
                    <a class="icon-btn"><span class="fas fa-user-circle"></span></a>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider round"></span>
                        <span class="switch-text-hide">Hide Spine Images</span>
                        <span class="switch-text-show">Show Spine Images</span>
                    </label>
                </div>
            </nav>
        </header>
        <div id="filters">
            <div class="current"></div>
            <div class="more"></div>
        </div>
        <div id="stack" class="">
            <div class="ctrl ctrl-left">
                <a class="icon-btn start"><span class="fas fa-step-backward"></span><span class="btn-text">Start</span></a>
                <a class="icon-btn backward"><span class="fas fa-angle-double-left"></span><span class="btn-text">Last 5</span></a>
            </div>
            <div class="ctrl ctrl-right">
                <a class="icon-btn end"><span class="fas fa-step-forward"></span><span class="btn-text">End</span></a>
                <a class="icon-btn forward"><span class="fas fa-angle-double-right"></span><span class="btn-text">Next 5</span></a>
            </div>

            <div id="stack-container">
                <div class="placeholder">
                    <div class="placeholder-container">
                        <p>You've reached the start of shelf</p>
                    </div>
                </div>
                <div class="item item-w-1 item-h-1">
                    <div class=item-title>
                        <h4>Eons and Rabbit</h4>
                        <span class="author"></span>
                    </div>
                    <!--                <span class="item-index"></span>-->
                </div>
                <div class="item item-w-2 item-h-2">
                    <div class=item-title>
                        <h4>The Vermorid Castle</h4><span class="author"></span>
                    </div>
                    <!--                <span class="item-index"></span>-->
                </div>
                <div class="item item-w-3 item-h-3">
                    <div class=item-title>
                        <h4>The Drapes for the Guest</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-1 item-h-2">
                    <div class=item-title>
                        <h4>Dimensional Things</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-2 item-h-3">
                    <div class=item-title>
                        <h4>Watcherborn</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Swindlers Of The Stars</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-1 item-h-3">
                    <div class=item-title>
                        <h4>Death At The South</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Lights In My Street</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-2">
                    <div class=item-title>
                        <h4>Branches</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-2">
                    <div class=item-title>
                        <h4>Fixed In Solar Flares</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Scared Of The End</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-2 item-h-2">
                    <div class=item-title>
                        <h4>Supporter Without Honor</h4><span class="author"></span>
                    </div>
                </div>

                <div class="item item-w-3 item-h-3">
                    <div class=item-title>
                        <h4>Armies And Assassins</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Birth Of Twilight</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-1 item-h-3">
                    <div class=item-title>
                        <h4>Fireflies</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-2 item-h-1">
                    <div class=item-title>
                        <h4>Roots of the Star</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>The Curious Incident of the Wolf from the North</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-1 item-h-1" style="background-color: #0D3248;">
                    <div class=item-title style="">
                        <h4>Everything I Never Told You</h4><span class="author">Celest Ng</span>
                    </div>
                    <div class="item-content">
                        <div class="item-det">
                            <img src="mockup_v3.png" style="width: 520px;">
                        </div>
                        <div class="item-avl">
                            <p>Availability</p>
                        </div>
                        <div class="item-rev">
                            <p>Review</p>
                        </div>
                        <div class="item-prv">
                            <p>Preview</p>
                        </div>
                        <div class="item-exp">
                            <h5>Suggestions</h5>
                            <div>
                                <div class="slider-container">
                                    <input type="range" min="1" max="10" value="8" class="slider" id="sugSlider">
                                    <span class="slider-label">Different</span>
                                    <span class="slider-label">Similar</span>
                                </div>
                                <!--
                                <div class="d-flex row" style="padding: 8px;">
                                    <div class="col-3 sugTitle"><a href="">Little Fires Everywhere</a></div>
                                    <div class="col-3 sugTitle"><a href="">The Light We Lost</a></div>
                                    <div class="col-3 sugTitle"><a href="">The Last Mrs. Parrish</a></div>
                                    <div class="col-3 sugTitle"><a href="">Before we were Yours</a></div>
                                </div>
-->
                                <img src="similar.png" style="width: 480px;">
                                <div class="d-flex row" style="padding: 8px;">
                                    <div class="col-3 sugWhy"><span>why?</span></div>
                                    <div class="col-3 sugWhy"><span>why?</span></div>
                                    <div class="col-3 sugWhy"><span>why?</span></div>
                                    <div class="col-3 sugWhy"><span>why?</span></div>
                                </div>
                            </div>
                            <div class="" style="height: 30px"></div>
                            <h5>Others Also Explored...</h5>
                            <!--                            <div id="sankey_multiple" style="width: 480px; height: 300px;"></div>-->
                            <img src="sankey.png" style="width: 480px;">
                        </div>
                    </div>
                </div>
                <div class="item item-w-3 item-h-2">
                    <div class=item-title>
                        <h4>First in Town</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Tracing</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Street Stray</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-3">
                    <div class=item-title>
                        <h4>Noah and the Moon</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>The Dawn Hospital</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-3">
                    <div class=item-title>
                        <h4>Fate Undercover</h4><span class="author"></span>
                    </div>
                </div>
                <div class="item item-w-3 item-h-1">
                    <div class=item-title>
                        <h4>Shattered Numbers</h4><span class="author"></span>
                    </div>
                </div>
                <div class="placeholder">
                    <div class="placeholder-container">
                        <p>You've reached the end of shelf</p>
                        <h6>More...</h6>
                        <a href="">Young Adults + Utopia + Family</a>
                        <a href="">Utopia + Family + Immigration</a>
                        <h6>Or...</h6>
                        <a href="">Another Random Shelf</a>
                    </div>
                </div>
            </div>
        </div>
        <div id="pop-up">
            <div id="pop-up-container">
                <header>
                    <h2></h2>
                    <a href=""><span class="author"></span></a>
                    <span class="year"></span>
                    <a class="icon-btn new-window" title="Open in a new window"><span class="fas fa-external-link-square-alt"></span></a>
                    <a class="icon-btn close" title="close"><span class="far fa-times-circle"></span></a>
                    <div class="preview-btn">
                        <script type="text/javascript">
                            GBS_insertPreviewButtonPopup('ISBN:0143127551');

                        </script>
                    </div>


                </header>
                <ul class="nav nav-tabs d-none" id="item_tab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" href="#detail" data-toggle="tab" role="tab" aria-controls="detail" area-selected='true'>Detail</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#avail" data-toggle="tab" role="tab" aria-controls="avail" area-selected='false'>Availability</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#review" data-toggle="tab" role="tab" aria-controls="review" area-selected='false'>Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#preview" data-toggle="tab" role="tab" aria-controls="preview" area-selected='false'>Preview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#explore" data-toggle="tab" role="tab" aria-controls="explore" area-selected='false'>Explore</a>
                    </li>
                </ul>
                <div class="item-content tab-content" id=item_tab_Content>
                    <!--
                    <div class="tab-pane fade show active" id="detail" role="tabpanel" aria-labelledby="detail-tab">
                    </div>
                    <div class="tab-pane fade" id="avail" role="tabpanel" aria-labelledby="avail-tab">
                        <p>avail</p>
                    </div>
                    <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                        <p>review</p>
                    </div>
                    <div class="tab-pane fade" id="preview" role="tabpanel" aria-labelledby="preview-tab">
                        <p>preview</p>
                    </div>
                    <div class="tab-pane fade" id="explore" role="tabpanel" aria-labelledby="explore-tab">
                        <p>explore</p>
                    </div>
-->
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript">
    function getRandomColor(mode, color) {
        var color
        if (mode == 'hsl') {
            if (color == 'blue') {
                color = 'hsl(204, 100%, ';
                color += (Math.floor(Math.random() * 5) + 14) * 5;
                color += '%)';

            } else if (color == 'orange') {
                color = 'hsl(25, 88%, ';
                color += (Math.floor(Math.random() * 7) + 12) * 5;
                color += '%)';
            }
        } else {
            color = '#';
            //        var letters = 'ABCDEF';
            //        for (var i = 0; i < 4; i++) {
            //            color += letters[Math.floor(Math.random() * 6)];
            //        }
            color += 'AB' [Math.floor(Math.random() * 2)]
            color += '6789AB' [Math.floor(Math.random() * 6)]
            color += 'CD' [Math.floor(Math.random() * 2)]
            color += '6789AB' [Math.floor(Math.random() * 6)]
            color += 'E5';
        }
        return color;
    }

    function loadSpineImage(items) {
        for (var i = 0; i < items.length; i++) {
            if (i < 9) {
                items.eq(i).css('background-image', "url(Item-0" + (i + 1) + ".png)");
            } else if (i == 9) {
                items.eq(i).css('background-image', "url(Item-10.png)");

            } else {
                items.eq(i).css('background-image', "url(Item-" + (i + 1) + ".png)");
            }
        }
    }

    $(document).ready(function() {

        var stackWidth = 1160;

        //Initiate stack and get item positions
        var stack = $('#stack-container');
        var items = $('.item');
        var positLeft = new Array();
        var activeIndex = 0;
        var stackScrollLeft = stack.scrollLeft();

        // Loop through items to get each position, and generate bg-color, author, index.
        for (var i = 0; i < items.length; i++) {
            positLeft.push(items.eq(i).position().left);
            items.eq(i).css('background-color', getRandomColor('hsl', 'blue'));

            if (i != 17) {
                items.eq(i).find('.author').text(
                    'ABCDEFGHIJKLMNOPQRSTUVWXYZ' [Math.floor(Math.random() * 26)] +
                    '. ' +
                    faker.name.lastName()
                );
            }
            items.eq(i).append('<span class="item-index">' + (i + 1) + '</span>');
            items.eq(i).append('<span class="year">' + (i == 17 ? 2014 : Math.floor(Math.random() * 28) + 1990) + '</span>');
        }
        loadSpineImage(items);



        //Buttons
        var btnEdit = $('#editBtn');
        var btnStar = $('.ctrl > .start'),
            btnBkwd = $('.ctrl > .backward'),
            btnFrwd = $('.ctrl > .forward'),
            btnEnd = $('.ctrl > .end');

        //Variables for
        var toPosition = 0; // Length for the stack to scroll to
        var collWidth;
        var rmScrollDuration = false;
        var itemActive = false;
        var scrollOffset = 0;
        var nativeScroll = true;

        $('.switch').trigger('click');
        stack.scrollTo(items.eq(0));
        btnStar.addClass('disable');
        btnBkwd.addClass('disable');

        btnEdit.click(function() {
            $('#filters').show();
            btnEdit.hide();
        });

        $('.switch').change(function() {
            if ($(this).children(":first").is(':checked')) {
                loadSpineImage(items);
                $('.item-title').hide();
                $('.switch-text-show').hide();
                $('.switch-text-hide').show();
            } else {
                for (var i = 0; i < items.length; i++) {
                    items.eq(i).css('background-image', 'none');
                }
                $('.item-title').show();
                $('.switch-text-show').show();
                $('.switch-text-hide').hide();
            }
        })

        $('.item').click(function() {

            itemActive = false;
            scrollOffset = 0;
            nativeScroll = false;

            activeIndex = jQuery.inArray(this, items);

            if (activeIndex == items.length - 1) {
                btnFrwd.addClass('disable');
                btnEnd.addClass('disable');
            } else {
                btnFrwd.removeClass('disable');
                btnEnd.removeClass('disable');
            }

            if (activeIndex > 0) {
                btnStar.removeClass('disable');
                btnBkwd.removeClass('disable');
            } else {
                btnStar.addClass('disable');
                btnBkwd.addClass('disable');
            }

            $('.item_selected').removeClass('item_selected').css({
                marginTop: '30px'
            });
            items.eq(activeIndex).addClass('item_selected').css({
                marginTop: '15px'
            });


            //            $('#pop-up').css('background-color', $(this).css('background-color'));
            $('#pop-up h2').text($(this).find('h4').text());
            $('#pop-up span.author').text($(this).find('span.author').text());
            $('#pop-up span.year').text($(this).find('span.year').text());
            $('#pop-up .item-content').html($(this).find('.item-det').html());
            //            $('#pop-up #detail').html($(this).find('.item-det').html());
            //            $('#pop-up .item-img').css('background-color', $(this).css('background-color'));
            //            $('#pop-up #avail').html($(this).find('.item-avl').html());
            //            $('#pop-up #review').html($(this).find('.item-rev').html());
            //            $('#pop-up #preview').html($(this).find('.item-prv').html());
            //            $('#pop-up #explore').html($(this).find('.item-exp').html());

            $('#pop-up .nav-link').eq(0).trigger('click');
            $('#pop-up .tab-pane').first().scrollTo(0);

            $('#pop-up').show("clip", {
                    direction: "horizontal"
                }, 150)
                .animate({
                    opacity: 1
                }, {
                    duration: 150,
                    queue: false
                });

            toPosition = positLeft[activeIndex] - 291.5;

            //            if (toPosition < 0) {
            //                $('.placeholder').first().width(Math.abs(toPosition));
            //            } else {
            //                $('.placeholder').first().width(0);
            //            }
            //
            //            collWidth = positLeft[items.length - 1] + 576;
            //            if (collWidth - toPosition < stackWidth) {
            //                $('.placeholder').last().width(stackWidth - collWidth + toPosition);
            //            } else {
            //                $('.placeholder').last().width(0);
            //            }

            stack.scrollTo(toPosition, rmScrollDuration ? 0 : 150, {
                axis: 'x',
                easing: 'easeInCubic',
                limit: false,
                onAfter: function() {
                    items.eq(activeIndex).addClass('item_selected');
                    itemActive = true;
                    rmScrollDuration = false;
                    nativeScroll = true;
                    stackScrollLeft = stack.scrollLeft();
                }
            });

        });

        $('.close').click(function() {

            $('#pop-up')
                .hide({
                    effect: "scale",
                    direction: "horizontal"
                }, 150)
                .animate({
                    opacity: 0
                }, {
                    duration: 150,
                    queue: false
                });

            //            $('.placeholder').each(function() {
            //                $(this).width(0);
            //            });
            itemActive = false;

            toPosition = positLeft[activeIndex] - stackWidth * 0.465;

            $('.item_selected').removeClass('item_selected').css({
                marginTop: '30px'
            });

            if (items.first().position().left > 0) {
                //                stack.scrollTo(items.eq(0), 100);
            } else if (items.last().position().left < (1160 - items.last().width())) {
                stack.scrollTo('-=' + (1160 - $('.placeholder').last().position().left).toString + 'px', 100)
            } else {
                stack.scrollTo(toPosition, 150);
            }

        });

        btnStar.click(function() {
            if (itemActive) {
                items.first().trigger('click');
            } else {
                stack.scrollTo(items.first(), 300, {
                    axis: 'x',
                    easing: 'easeInOutCubic'
                });
            }
        });
        btnEnd.click(function() {
            if (itemActive) {
                items.last().trigger('click');
            } else {
                stack.scrollTo($('.placeholder').last(), 300, {
                    axis: 'x',
                    easing: 'easeInOutCubic'
                });
            }
        });
        btnBkwd.click(function() {
            if (itemActive) {
                if (activeIndex <= 4) {
                    items.eq(0).trigger('click');
                } else {
                    items.eq(activeIndex - 5).trigger('click');
                }
            } else {
                stack.scrollTo("-=320px", 300, {
                    axis: 'x',
                    easing: 'easeInOutCubic'
                });
            }
        });
        btnFrwd.click(function() {
            if (itemActive) {
                if (activeIndex + 5 >= items.length) {
                    items.last().trigger('click');
                } else {
                    items.eq(activeIndex + 5).trigger('click');

                }
            } else {
                stack.scrollTo("+=320px", 300, {
                    axis: 'x',
                    easing: 'easeInOutCubic'
                });
            }
        });

        $(document).keydown(function(e) {
            switch (e.which) {
                case 37:
                    if (itemActive && activeIndex > 0) {
                        $('.item_selected').prev().trigger("click");
                    }
                    break;
                case 39:
                    if (itemActive && activeIndex < items.length - 1) {
                        $('.item_selected').next().trigger("click");
                    }
                    break;
            }
        });


        stack.scroll(function(e) {
            if (itemActive) {
                if (nativeScroll) {
                    scrollOffset = $(this).scrollLeft() - stackScrollLeft;
                    if (activeIndex == 0 && scrollOffset < 0) {
                        //                        stack.scrollLeft(items.first().position().left);
                        e.preventDefault();
                        return false;
                    } else {
                        if (scrollOffset > 10) {
                            rmScrollDuration = true;
                            switched = true;
                            $('.item_selected').next().trigger("click");
                        } else if (scrollOffset < -10) {
                            rmScrollDuration = true;
                            switched = true;
                            $('.item_selected').prev().trigger("click");
                        } else {}
                    }
                }
            } else {
                //                if ($('.item').first().position().left < 50) {
                //                    btnStar.addClass('disable');
                //                    btnBkwd.addClass('disable');
                //                } else {
                //                    btnStar.removeClass('disable');
                //                    btnBkwd.removeClass('disable');
                //                }
            }
        });

    });

</script>
